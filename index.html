<html>
<head>
<style>
#chatwin {
font-family: Verdana,Arial,sans-serif;
font-size:10pt;
}
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
jQuery(document).ready(function() { 

    var socket = io.connect('http://50.17.232.32/');
	var nick = $('#nick').val()
    socket.on('news', function (data) {
        msg = data.msg.replace(/\n/g,'<br>')
		console.log(data)
        $('#dialog').append('<span style="color:'+data.color+'">'+data.sender+": "+msg+'</span><br>')
		$("#dialog").attr({ scrollTop: $("#dialog").attr("scrollHeight") });
    });
    
    socket.on('namechange', function (data) {
        console.log(data)
        buffer = ''
        for (i=0; i<data.senderlist.length; i++) {
            buffer += '<span style="color:'+data.senderlist[i]['color']+'">'+data.senderlist[i]['nick']+'</span><br>'
        }
        $('#users').html(buffer)
		// system message
        msg = data.msg.replace(/\n/g,'<br>')
        $('#dialog').append('<span style="color:'+data.color+'">'+data.sender+": "+msg+'</span><br>')
		$("#dialog").attr({ scrollTop: $("#dialog").attr("scrollHeight") });
    });



    $('#stuff').keyup(function(e) {
        if(e.keyCode == 13 && !e.shiftKey) {
			if ($('#nick').val().trim() == '') {
				alert('You must create a nickname first')
				return
			}
            msg  = $('#stuff').val().trim()
            if (msg != "\n") {
                nick = $('#nick').val().trim()
                socket.emit('speak', { msg:msg, sender:nick });
            }
            $('#stuff').val('')
        }
    });

    $('#nick').change(function(){
	    socket.emit('namechange', { old_sender:nick, sender:$(this).val().trim() });
        nick = $(this).val().trim()
    });


    nick = $('#nick').val().trim()
	if ( nick != '') {
	    socket.emit('namechange', { old_sender:'', sender:nick });
	}
});
</script>
</head>
<body>
<div id="chatwin" style="width:604px">
<div id="dialog" style="width:400px;height:300px;border:solid silver 1px;float:left;overflow-y:scroll">
</div>
<div id="users" style="width:200px;height:300px;border:solid silver 1px;float:left">
</div>
<div style="width:100px;float:left;clear:left">Nickname:</div><input id="nick" style="width:504px;float:left" value=""><br>
<textarea id="stuff" style="width:604px;height:60px;clear:left"></textarea>
</div>
</body>
</html>
