<html>
<head>
<style>
body {
 background-color:black;
}
#chatwin {
 background-color:#DDD;
 font-family:  monospace;sans-serif;
 font-size:13.3333px;
 width:604px;
 padding:5px;
}
#title {
 padding:1px;
 font-weight:bold;
 font-size:11px;
}
#dialog {
 padding:5px;
 width:390px;
 height:300px;
 border:solid silver 1px;
 float:left;
 overflow-y:scroll;
 background-color:#FFF;
}
#users {
 padding:5px;
 background-color:#FDFDFD;
 width:190px;
 height:300px;
 border:solid silver 1px;
 float:left;
 overflow-y:scroll;
}
#label_nick {
 padding:5px;
 width:90px;
 float:left;
 clear:left;
 margin-top:5px;
}
#nick {
 width:490px;
 float:left;
 margin-top:5px;
}
#stuff{
 width:604px;
 height:60px;
 clear:left;
}
</style>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
jQuery(document).ready(function() { 
    var socket = io.connect('/');
	var nick = $('#nick').val()
    socket.on('news', function (data) {
        msg = data.msg.replace(/\n/g,'<br>')
        $('#dialog').append('<span style="color:'+data.sender.color+'">&lt;'+data.sender.nick+'&gt;'+msg+'</span><br>')
		$("#dialog").attr({ scrollTop: $("#dialog").attr("scrollHeight") });
    });
    
    socket.on('namechange', function (data) {
        console.log(data)
        buffer = ''
        for (i=0; i<data.senderlist.length; i++) {
            buffer += '<span style="color:'+data.senderlist[i]['color']+'">'+data.senderlist[i]['nick']+'</span><br>'
        }
        $('#users').html(buffer)
		// system message
        msg = data.msg.replace(/\n/g,'<br>')
        $('#dialog').append('<span style="color:'+data.color+'">'+data.sender+": "+msg+'</span><br>')
		$("#dialog").attr({ scrollTop: $("#dialog").attr("scrollHeight") });
    });

    $('#stuff').keyup(function(e) {
        if(e.keyCode == 13 && !e.shiftKey) {
			if ($('#nick').val().trim() == '') {
				alert('You must create a nickname first')
				return
			}
            msg  = $('#stuff').val().trim()
            if (msg != "\n") {
                nick = $('#nick').val().trim()
                socket.emit('speak', { msg:msg, sender:nick });
            }
            $('#stuff').val('')
        }
    });

    $('#nick').change(function(){
	    socket.emit('namechange', { old_sender:nick, sender:$(this).val().trim() });
        nick = $(this).val().trim()
    });


    nick = $('#nick').val().trim()
	if ( nick != '') {
	    socket.emit('namechange', { old_sender:'', sender:nick });
	}
});
</script>
</head>
<body>
<div id="chatwin">
 <div id="title">Branded Chat</div>
 <div id="dialog"></div>
 <div id="users"></div>
 <div id="label_nick">Nickname:</div><input id="nick" value=""><br>
 <textarea id="stuff"></textarea>
</div>
</body>
</html>
